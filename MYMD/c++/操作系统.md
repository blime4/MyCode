# 操作系统笔记

[TOC]



## 常用函数

### lockf(files,function,size)

> 用作锁定文件的某些段或者整个文件。
>
> 本函数的头文件为
>
> ```c++
> #include "unistd.h"
> ```
>
> 参数定义：
>
> ```c++
> int  lockf(files,function,size)
> int  files,function;
> long  size;
> ```
>
> 其中：files是文件描述符；function是锁定和解锁：1表示锁定，0表示解锁。size是锁定或解锁的字节数，为0，表示从文件的当前位置到文件尾。  



### fork()

> 创建一个新进程。 
>
> 系统调用格式： 
>
> pid=fork( )
>
> 参数定义：
>
> int fork( )
>
> fork( )返回值意义如下：
>
> 0：在子进程中，pid变量保存的fork( )返回值为0，表示当前进程是子进程。
>
> \>0：在父进程中，pid变量保存的fork( )返回值为子进程的id值（进程唯一标识符）。
>
> -1：创建失败。
>
> 如果fork( )调用成功，它向父进程返回子进程的PID，并向子进程返回0，即fork( )被调用了一次，但返回了两次。此时OS在内存中建立一个新进程，所建的新进程是调用fork( )父进程（parent process）的副本，称为子进程（child process）。子进程继承了父进程的许多特性，并具有与父进程完全相同的用户级上下文。父进程与子进程并发执行。
>
> 核心为fork( )完成以下操作：
>
> （1）为新进程分配一进程表项和进程标识符
>
> 进入fork( )后，核心检查系统是否有足够的资源来建立一个新进程。若资源不足，则fork( )系统调用失败；否则，核心为新进程分配一进程表项和唯一的进程标识符。
>
> （2）检查同时运行的进程数目
>
> 超过预先规定的最大数目时，fork( )系统调用失败。
>
> （3）拷贝进程表项中的数据
>
> 将父进程的当前目录和所有已打开的数据拷贝到子进程表项中，并置进程的状态为“创建”状态。
>
> （4）子进程继承父进程的所有文件
>
> 对父进程当前目录和所有已打开的文件表项中的引用计数加1。
>
> （5）为子进程创建进程上、下文
>
> 进程创建结束，设子进程状态为“内存中就绪”并返回子进程的标识符。
>
> （6）子进程执行
>
> 虽然父进程与子进程程序完全相同，但每个进程都有自己的程序计数器**PC(****注意子进程的PC****开始位置)**，然后根据pid变量保存的fork( )返回值的不同，执行了不同的分支语句。

